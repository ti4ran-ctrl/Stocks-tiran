<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¢×§×‘ ×× ×™×•×ª - ××•×ª×•×ª ×§× ×™×™×” ×•××›×™×¨×”</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Heebo', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .stock-card {
            transition: all 0.3s ease;
        }
        
        .stock-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .signal-buy {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        
        .signal-sell {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }
        
        .signal-hold {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: .7;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ×¨×©×™××ª ×× ×™×•×ª ×œ×¤×™ ×¡×§×˜×•×¨
        const stockSymbols = {
            technology: [
                { symbol: 'AAPL', name: 'Apple' },
                { symbol: 'MSFT', name: 'Microsoft' },
                { symbol: 'GOOGL', name: 'Google' },
                { symbol: 'META', name: 'Meta' },
                { symbol: 'NVDA', name: 'NVIDIA' },
                { symbol: 'TSLA', name: 'Tesla' }
            ],
            energy: [
                { symbol: 'XOM', name: 'Exxon Mobil' },
                { symbol: 'CVX', name: 'Chevron' },
                { symbol: 'COP', name: 'ConocoPhillips' }
            ],
            banking: [
                { symbol: 'JPM', name: 'JPMorgan Chase' },
                { symbol: 'BAC', name: 'Bank of America' },
                { symbol: 'WFC', name: 'Wells Fargo' }
            ]
        };

        // ×¤×•× ×§×¦×™×” ×œ×—×™×©×•×‘ RSI ×× ×ª×•× ×™ ×”×™×¡×˜×•×¨×™×”
        const calculateRSI = (prices, period = 14) => {
            if (prices.length < period + 1) return 50;
            
            let gains = 0;
            let losses = 0;
            
            for (let i = prices.length - period; i < prices.length; i++) {
                const change = prices[i] - prices[i - 1];
                if (change > 0) gains += change;
                else losses -= change;
            }
            
            const avgGain = gains / period;
            const avgLoss = losses / period;
            
            if (avgLoss === 0) return 100;
            const rs = avgGain / avgLoss;
            return 100 - (100 / (1 + rs));
        };

        // ×¤×•× ×§×¦×™×” ×œ×§×‘×œ×ª × ×ª×•× ×™ ×× ×™×” ×-Yahoo Finance
        const fetchStockData = async (symbol) => {
            try {
                // Yahoo Finance API ×“×¨×š proxy ×—×™× ××™
                const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=1mo`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (!data.chart || !data.chart.result || data.chart.result.length === 0) {
                    throw new Error('No data available from Yahoo Finance');
                }
                
                const result = data.chart.result[0];
                const quote = result.indicators.quote[0];
                const prices = quote.close;
                const meta = result.meta;
                
                // × ×ª×•× ×™× × ×•×›×—×™×™×
                const currentPrice = meta.regularMarketPrice || prices[prices.length - 1];
                const previousClose = meta.chartPreviousClose;
                const change = ((currentPrice - previousClose) / previousClose * 100);
                
                // ×—×™×©×•×‘ RSI ×××™×ª×™ ××”×™×¡×˜×•×¨×™×”
                const rsi = Math.round(calculateRSI(prices.filter(p => p !== null)));
                
                // ××—×™×¨×™× ×’×‘×•×”/× ××•×š ×©×œ ×”×™×•×
                const high = quote.high[quote.high.length - 1] || currentPrice;
                const low = quote.low[quote.low.length - 1] || currentPrice;
                
                // ×§×‘×™×¢×ª ××•×ª ××‘×•×¡×¡ ×¢×œ RSI ×•××’××”
                let signal, trend;
                
                if (rsi < 35) {
                    signal = 'buy';
                    trend = 'up';
                } else if (rsi > 65) {
                    signal = 'sell';
                    trend = 'down';
                } else {
                    signal = 'hold';
                    trend = change > 0 ? 'up' : change < 0 ? 'down' : 'neutral';
                }
                
                // ×ª×™×§×•×Ÿ ×œ××§×¨×” ×©×”-RSI ××¢×™×“ ×¢×œ ××›×™×¨×ª ×™×ª×¨ ××‘×œ ×”××—×™×¨ ×¢×•×œ×”
                if (rsi < 30 && change > 0) {
                    signal = 'buy';
                    trend = 'up';
                }
                
                // ×ª×™×§×•×Ÿ ×œ××§×¨×” ×©×”-RSI ××¢×™×“ ×¢×œ ×§× ×™×™×ª ×™×ª×¨ ××‘×œ ×”××—×™×¨ ×™×•×¨×“
                if (rsi > 70 && change < 0) {
                    signal = 'sell';
                    trend = 'down';
                }
                
                return {
                    price: currentPrice,
                    change: parseFloat(change.toFixed(2)),
                    rsi: rsi,
                    signal: signal,
                    trend: trend,
                    high: high,
                    low: low,
                    volume: quote.volume[quote.volume.length - 1]
                };
                
            } catch (error) {
                console.error(`Error fetching ${symbol} from Yahoo:`, error);
                
                // ×‘××§×¨×” ×©×œ ×©×’×™××”, × × ×¡×” ×“×¨×š proxy ××œ×˜×¨× ×˜×™×‘×™
                try {
                    const fallbackUrl = `https://query2.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=5d`;
                    const fallbackResponse = await fetch(fallbackUrl);
                    const fallbackData = await fallbackResponse.json();
                    
                    if (fallbackData.chart && fallbackData.chart.result && fallbackData.chart.result.length > 0) {
                        const result = fallbackData.chart.result[0];
                        const quote = result.indicators.quote[0];
                        const prices = quote.close.filter(p => p !== null);
                        const meta = result.meta;
                        
                        const currentPrice = meta.regularMarketPrice || prices[prices.length - 1];
                        const previousClose = prices[prices.length - 2] || meta.chartPreviousClose;
                        const change = ((currentPrice - previousClose) / previousClose * 100);
                        
                        return {
                            price: currentPrice,
                            change: parseFloat(change.toFixed(2)),
                            rsi: Math.round(calculateRSI(prices)),
                            signal: 'hold',
                            trend: change > 0 ? 'up' : 'down',
                            high: quote.high[quote.high.length - 1] || currentPrice,
                            low: quote.low[quote.low.length - 1] || currentPrice,
                            volume: quote.volume[quote.volume.length - 1]
                        };
                    }
                } catch (fallbackError) {
                    console.error(`Fallback also failed for ${symbol}:`, fallbackError);
                }
                
                // ×× ×”×›×œ × ×›×©×œ, × ×—×–×™×¨ ×¢×¨×›×™ ×‘×¨×™×¨×ª ××—×“×œ
                return {
                    price: 0,
                    change: 0,
                    rsi: 50,
                    signal: 'hold',
                    trend: 'neutral',
                    high: 0,
                    low: 0,
                    volume: 0,
                    error: true
                };
            }
        };

        const sectorNames = {
            technology: '×˜×›× ×•×œ×•×’×™×”',
            energy: '×× ×¨×’×™×”',
            banking: '×‘× ×§×™×'
        };

        function App() {
            const [selectedSector, setSelectedSector] = useState('technology');
            const [stocks, setStocks] = useState([]);
            const [lastUpdate, setLastUpdate] = useState(new Date());
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            // ×˜×¢×™× ×ª × ×ª×•× ×™× ×¢×‘×•×¨ ×¡×§×˜×•×¨ × ×‘×—×¨
            const loadStockData = async (sector) => {
                setLoading(true);
                setError(null);
                
                try {
                    const stockList = stockSymbols[sector];
                    const stockPromises = stockList.map(async (stock) => {
                        const data = await fetchStockData(stock.symbol);
                        return {
                            symbol: stock.symbol,
                            name: stock.name,
                            ...data
                        };
                    });
                    
                    const loadedStocks = await Promise.all(stockPromises);
                    setStocks(loadedStocks);
                    setLastUpdate(new Date());
                } catch (err) {
                    setError('×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×. ×× ×¡×” ×©×•×‘...');
                    console.error(err);
                } finally {
                    setLoading(false);
                }
            };

            // ×˜×¢×™× ×” ×¨××©×•× ×™×ª
            useEffect(() => {
                loadStockData(selectedSector);
            }, [selectedSector]);

            // ×¢×“×›×•×Ÿ ××•×˜×•××˜×™ ×›×œ ×“×§×”
            useEffect(() => {
                const interval = setInterval(() => {
                    loadStockData(selectedSector);
                }, 60000); // ×¢×“×›×•×Ÿ ×›×œ ×“×§×”

                return () => clearInterval(interval);
            }, [selectedSector]);

            const getSignalText = (signal) => {
                switch(signal) {
                    case 'buy': return '×§× ×”';
                    case 'sell': return '××›×•×¨';
                    case 'hold': return '×”××ª×Ÿ';
                    default: return '×”××ª×Ÿ';
                }
            };

            const getSignalClass = (signal) => {
                switch(signal) {
                    case 'buy': return 'signal-buy';
                    case 'sell': return 'signal-sell';
                    case 'hold': return 'signal-hold';
                    default: return 'signal-hold';
                }
            };

            const getTrendIcon = (trend) => {
                switch(trend) {
                    case 'up': return 'ğŸ“ˆ';
                    case 'down': return 'ğŸ“‰';
                    default: return 'â¡ï¸';
                }
            };

            return (
                <div className="min-h-screen pb-20">
                    {/* Header */}
                    <div className="gradient-bg text-white p-6 shadow-lg">
                        <h1 className="text-3xl font-bold mb-2">ğŸ“Š ××¢×§×‘ ×× ×™×•×ª</h1>
                        <p className="text-sm opacity-90">×‘×•×¨×¡×” ×××¨×™×§××™×ª - × ×ª×•× ×™× ×‘×–××Ÿ ×××ª</p>
                        <p className="text-xs mt-2 opacity-75">
                            ×¢×“×›×•×Ÿ ××—×¨×•×Ÿ: {lastUpdate.toLocaleTimeString('he-IL')}
                        </p>
                        {loading && (
                            <div className="mt-2 flex items-center gap-2">
                                <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-white"></div>
                                <span className="text-xs">××¢×“×›×Ÿ × ×ª×•× ×™×...</span>
                            </div>
                        )}
                    </div>

                    {/* Sector Tabs */}
                    <div className="bg-white shadow-md sticky top-0 z-10">
                        <div className="flex overflow-x-auto p-2 gap-2">
                            {Object.keys(stockSymbols).map(sector => (
                                <button
                                    key={sector}
                                    onClick={() => setSelectedSector(sector)}
                                    className={`px-6 py-3 rounded-lg font-semibold whitespace-nowrap transition-all ${
                                        selectedSector === sector
                                            ? 'bg-purple-600 text-white shadow-lg'
                                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                    }`}
                                >
                                    {sectorNames[sector]}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Error Message */}
                    {error && (
                        <div className="mx-4 mt-4 bg-red-50 border-r-4 border-red-500 p-4 rounded-lg">
                            <p className="text-red-800">{error}</p>
                        </div>
                    )}

                    {/* Stocks Grid */}
                    <div className="p-4 max-w-7xl mx-auto">
                        {loading && stocks.length === 0 ? (
                            <div className="flex justify-center items-center py-20">
                                <div className="text-center">
                                    <div className="animate-spin rounded-full h-16 w-16 border-b-2 border-purple-600 mx-auto mb-4"></div>
                                    <p className="text-gray-600">×˜×•×¢×Ÿ × ×ª×•× ×™×...</p>
                                </div>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                {stocks.map(stock => (
                                    <div key={stock.symbol} className="stock-card bg-white rounded-xl shadow-md p-5 border-2 border-gray-100">
                                        {/* Stock Header */}
                                        <div className="flex justify-between items-start mb-4">
                                            <div>
                                                <h3 className="text-xl font-bold text-gray-800">{stock.symbol}</h3>
                                                <p className="text-sm text-gray-500">{stock.name}</p>
                                            </div>
                                            <span className="text-2xl">{getTrendIcon(stock.trend)}</span>
                                        </div>

                                        {/* Price */}
                                        <div className="mb-4">
                                            <p className="text-3xl font-bold text-gray-900">${stock.price.toFixed(2)}</p>
                                            <p className={`text-sm font-semibold ${stock.change >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                {stock.change >= 0 ? 'â–²' : 'â–¼'} {Math.abs(stock.change)}%
                                            </p>
                                            {stock.high > 0 && !stock.error && (
                                                <div className="text-xs text-gray-500 mt-1">
                                                    <span>×’×‘×•×”: ${stock.high.toFixed(2)}</span> | 
                                                    <span> × ××•×š: ${stock.low.toFixed(2)}</span>
                                                </div>
                                            )}
                                            {stock.volume > 0 && !stock.error && (
                                                <div className="text-xs text-gray-400 mt-1">
                                                    × ×¤×—: {(stock.volume / 1000000).toFixed(2)}M
                                                </div>
                                            )}
                                            {stock.error && (
                                                <div className="text-xs text-red-500 mt-1">
                                                    âš ï¸ × ×ª×•× ×™× ×œ× ×–××™× ×™× ×›×¨×’×¢
                                                </div>
                                            )}
                                        </div>

                                        {/* RSI Indicator */}
                                        <div className="mb-4">
                                            <div className="flex justify-between text-xs mb-1">
                                                <span className="text-gray-600">RSI</span>
                                                <span className="font-semibold">{stock.rsi}</span>
                                            </div>
                                            <div className="w-full bg-gray-200 rounded-full h-2">
                                                <div 
                                                    className={`h-2 rounded-full ${
                                                        stock.rsi < 30 ? 'bg-green-500' : 
                                                        stock.rsi > 70 ? 'bg-red-500' : 
                                                        'bg-yellow-500'
                                                    }`}
                                                    style={{ width: `${stock.rsi}%` }}
                                                ></div>
                                            </div>
                                            <p className="text-xs text-gray-500 mt-1">
                                                {stock.rsi < 30 ? '××›×™×¨×ª ×™×ª×¨ - ×”×–×“×× ×•×ª!' : stock.rsi > 70 ? '×§× ×™×™×ª ×™×ª×¨ - ×–×”×™×¨×•×ª!' : '× ×™×™×˜×¨×œ×™'}
                                            </p>
                                        </div>

                                        {/* Signal Button */}
                                        <button className={`w-full ${getSignalClass(stock.signal)} text-white font-bold py-3 px-4 rounded-lg shadow-md ${stock.signal === 'buy' || stock.signal === 'sell' ? 'pulse' : ''}`}>
                                            ğŸ¯ {getSignalText(stock.signal)}
                                        </button>
                                    </div>
                                ))}
                            </div>
                        )}

                        {/* API Info */}
                        <div className="mt-8 bg-green-50 border-r-4 border-green-500 p-4 rounded-lg">
                            <h4 className="font-bold text-green-900 mb-2">âœ… × ×ª×•× ×™× ×‘×–××Ÿ ×××ª ×-Yahoo Finance</h4>
                            <p className="text-sm text-green-800">
                                ×”××¤×œ×™×§×¦×™×” ××•×©×›×ª × ×ª×•× ×™× ×××™×ª×™×™× ×•×××™× ×™× ×-Yahoo Finance - ××—×“ ×”××§×•×¨×•×ª ×”××•×‘×™×œ×™× ×•×”×××™× ×™× ×‘×™×•×ª×¨ ×œ× ×ª×•× ×™ ×‘×•×¨×¡×”.
                                ×”× ×ª×•× ×™× ×›×•×œ×œ×™× ××—×™×¨×™× ×¢×“×›× ×™×™×, RSI ××—×•×©×‘ ××”×™×¡×˜×•×¨×™×” ×××™×ª×™×ª, × ×¤×—×™ ××¡×—×¨ ×•×¢×•×“.
                            </p>
                            <p className="text-xs text-green-700 mt-2">
                                ğŸ”„ ×”× ×ª×•× ×™× ××ª×¢×“×›× ×™× ××•×˜×•××˜×™×ª ×›×œ ×“×§×” | ğŸ’¡ ×œ×—×¥ ×¢×œ ×”×˜××‘×™× ×œ××¢×œ×” ×›×“×™ ×œ×¢×‘×•×¨ ×‘×™×Ÿ ×¡×§×˜×•×¨×™×
                            </p>
                        </div>

                        {/* Info Box */}
                        <div className="mt-4 bg-blue-50 border-r-4 border-blue-500 p-4 rounded-lg">
                            <h4 className="font-bold text-blue-900 mb-2">ğŸ’¡ ×”×¡×‘×¨ ×¢×œ ×”××™× ×“×™×§×˜×•×¨×™×</h4>
                            <ul className="text-sm text-blue-800 space-y-1">
                                <li><strong>RSI (Relative Strength Index):</strong> ××“×“ ×›×•×— ×™×—×¡×™ - ××ª×—×ª ×œ-30 = ××›×™×¨×ª ×™×ª×¨ (×”×–×“×× ×•×ª ×§× ×™×™×”), ××¢×œ 70 = ×§× ×™×™×ª ×™×ª×¨ (×©×§×•×œ ××›×™×¨×”)</li>
                                <li><strong>××•×ª ×§× ×™×™×” ğŸ“ˆ:</strong> ×”×× ×™×” ×‘××’××ª ×¢×œ×™×™×” ×¢× ×¤×•×˜× ×¦×™××œ ×œ×¨×•×•×—</li>
                                <li><strong>××•×ª ××›×™×¨×” ğŸ“‰:</strong> ×”×× ×™×” ×¢×œ×ª×” ×××•×“ ×•×¢×œ×•×œ×” ×œ×¨×“×ª</li>
                                <li><strong>×”××ª×Ÿ â¡ï¸:</strong> ××•××œ×¥ ×œ×—×›×•×ª ×œ××•×ª ×‘×¨×•×¨ ×™×•×ª×¨</li>
                            </ul>
                        </div>

                        {/* Disclaimer */}
                        <div className="mt-4 bg-yellow-50 border-r-4 border-yellow-500 p-4 rounded-lg">
                            <p className="text-xs text-yellow-800">
                                <strong>âš ï¸ ××–×”×¨×”:</strong> ×”××™×“×¢ ×‘××¤×œ×™×§×¦×™×” ×–×• ××•×¦×’ ×œ×¦×¨×›×™ ××™×“×¢ ×‘×œ×‘×“ ×•××™× ×• ××”×•×•×” ×™×™×¢×•×¥ ×”×©×§×¢×•×ª. 
                                ×”×ª×™×™×¢×¥ ×¢× ×™×•×¢×¥ ×¤×™× × ×¡×™ ××•×¡××š ×œ×¤× ×™ ×‘×™×¦×•×¢ ×”×©×§×¢×•×ª. ×©×•×§ ×”×× ×™×•×ª ×›×¨×•×š ×‘×¡×™×›×•×Ÿ ××©××¢×•×ª×™.
                            </p>
                        </div>
                    </div>
                </div>
            );
